function css_browser_selector(u){var ua=u.toLowerCase(),is=function(t){return ua.indexOf(t)>-1},g="gecko",w="webkit",s="safari",o="opera",m="mobile",h=document.documentElement,b=[!/opera|webtv/i.test(ua)&&/msie\s(\d)/.test(ua)?"ie ie"+RegExp.$1:is("firefox/2")?g+" ff2":is("firefox/3.5")?g+" ff3 ff3_5":is("firefox/3.6")?g+" ff3 ff3_6":is("firefox/3")?g+" ff3":is("gecko/")?g:is("opera")?o+(/version\/(\d+)/.test(ua)?" "+o+RegExp.$1:/opera(\s|\/)(\d+)/.test(ua)?" "+o+RegExp.$2:""):is("konqueror")?"konqueror":is("blackberry")?m+" blackberry":is("android")?m+" android":is("chrome")?w+" chrome":is("iron")?w+" iron":is("applewebkit/")?w+" "+s+(/version\/(\d+)/.test(ua)?" "+s+RegExp.$1:""):is("mozilla/")?g:"",is("j2me")?m+" j2me":is("iphone")?m+" iphone":is("ipod")?m+" ipod":is("ipad")?m+" ipad":is("mac")?"mac":is("darwin")?"mac":is("webtv")?"webtv":is("win")?"win"+(is("windows nt 6.0")?" vista":""):is("freebsd")?"freebsd":is("x11")||is("linux")?"linux":"","js"];return c=b.join(" "),h.className+=" "+c,c}function str_repeat(i,m){for(var o=[];m>0;o[--m]=i);return o.join("")}function sprintf(){for(var a,m,p,c,x,i=0,f=arguments[i++],o=[],s="";f;){if(m=/^[^\x25]+/.exec(f))o.push(m[0]);else if(m=/^\x25{2}/.exec(f))o.push("%");else{if(!(m=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(f)))throw"Huh ?!";if(null==(a=arguments[m[1]||i++])||void 0==a)throw"Too few arguments.";if(/[^s]/.test(m[7])&&"number"!=typeof a)throw"Expecting number but found "+typeof a;switch(m[7]){case"b":a=a.toString(2);break;case"c":a=String.fromCharCode(a);break;case"d":a=parseInt(a);break;case"e":a=m[6]?a.toExponential(m[6]):a.toExponential();break;case"f":a=m[6]?parseFloat(a).toFixed(m[6]):parseFloat(a);break;case"o":a=a.toString(8);break;case"s":a=(a=String(a))&&m[6]?a.substring(0,m[6]):a;break;case"u":a=Math.abs(a);break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase()}a=/[def]/.test(m[7])&&m[2]&&a>=0?"+"+a:a,c=m[3]?"0"==m[3]?"0":m[3].charAt(1):" ",x=m[5]-String(a).length-s.length,p=m[5]?str_repeat(c,x):"",o.push(s+(m[4]?a+p:p+a))}f=f.substring(m[0].length)}return o.join("")}function markButtons(dialogId){var $buttons=$("#"+dialogId).next().find(".ui-button");$buttons.each(function(index,value){$(value).addClass(dialogId+"-button-"+index)})}function AlbumUploader(){this.BASE_URL="","undefined"!=typeof STATIC_BASE_URL&&(this.BASE_URL=STATIC_BASE_URL),this.ALBUM_BEGIN_URL=this.BASE_URL+"/website_api/album/begin",this.ALBUM_END_URL=this.BASE_URL+"/website_api/album/{{ALBUM_ID}}/end",this.ALBUM_STATUS_URL=this.BASE_URL+"/website_api/album/{{ALBUM_ID}}",this.GET_POLICY_URL=this.BASE_URL+"/website_api/get_upload_policy_params",this.UPLOAD_START_URL=this.BASE_URL+"/website_api/album/{{ALBUM_ID}}/upload_start/{{ITEM_ID}}",this.UPLOAD_COMPLETE_URL=this.BASE_URL+"/website_api/album/{{ALBUM_ID}}/upload_complete/{{ITEM_ID}}",this.ALBUM_PROGRESS_UPDATE_TIMER=1e4,this.MAX_ERROR_RETRY_COUNT=4,this.MAX_UPLOAD_RETRY_COUNT=3,this.MAX_QUEUE_FILES_SIZE_LIMIT=200;var me=this;me.swfuploader=null,this.onFileDialogStart=function(){me.swfuploader=this,me.fileDialogStart()},this.onFileQueued=function(f){me.swfuploader=this,me.fileQueued(f,1e3,1)},this.onFileDialogComplete=function(s,q,tqs){me.swfuploader=this,me.fileDialogComplete(s,q,tqs)},this.onFileQueueError=function(f,e,m){me.swfuploader=this,me.fileQueueError(f,e,m)},this.onUploadStart=function(f){me.swfuploader=this,me.uploadStart(f)},this.onUploadProgress=function(f,b,t){me.swfuploader=this,me.uploadProgress(f,b,t)},this.onUploadSuccess=function(f,s,r){me.swfuploader=this,me.uploadSuccess(f,s,r)},this.onUploadError=function(f,e,m){me.swfuploader=this,me.uploadError(f,e,m,1e3,1)},this.onUploadComplete=function(f){me.swfuploader=this,me.uploadComplete(f)},this.events={},_.extend(this.events,Backbone.Events),this.initStats=function(){this.albumId=null,this.fileParamsReceived=0,this.filesEnqueud=0,this.filesUploaded=0,this.filesReallyUploaded=0,this.filesUploadedSuccess=0,this.filesUploadedError=0,this.filesProcessedSuccess=0,this.filesProcessedError=0,this.totalProcessed=0,this.totalBytes=0,this.uploadBytes=0,this.completedUploads=[],this.queueTotalFilesSizeError=!1,this.uploadInProgress=!1,this.fileToData={},this.uploadQueue=$({})},this.initStats(),this.tryTriggerUpload=function(){return this.uploadInProgress?void $.log("upload in progress. aborting"):this.queueTotalFilesSizeError?void $.log("Total files size in queue limitation. aborting"):this.albumId?this.uploadQueue.queue("pendingUploads").length<=0?void $.log("Queue is empty. aborting"):($.log("triggering next upload"),void this.uploadQueue.dequeue("pendingUploads")):void $.log("No album id. aborting")},this.fileDialogStart=function(){var me=this;this.initStats(),$.log("Getting album info");var url=this.ALBUM_BEGIN_URL+"?rand="+Math.random();$.getJSON(url,function(data){$.log("Album id: "+data.album_id),me.albumId=data.album_id,me.tryTriggerUpload()}),this.events.trigger("onFileDialogStart",this.getEventData())},this.fileDialogComplete=function(nSelected,nQueued){this.filesEnqueud+=nQueued,$.log("fileDialogComplete - enqued "+this.filesEnqueud+" files"),this.events.trigger("onFileDialogComplete",this.getEventData())},this.fileQueued=function(file,delay,count){var me=this;if($.log("file queued: "+file.name),me.fileToData[file.id]={itemId:"",key:"",uploadAttempts:0,hasError:!1,errorCode:0},me.totalBytes+=file.size,me.queueTotalFilesSizeError)return!1;if(me.totalBytes/1048576>me.MAX_QUEUE_FILES_SIZE_LIMIT)return me.queueTotalFilesSizeError=!0,me.events.trigger("onLimitExceeded",SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT,me.getEventData()),!1;var url=this.GET_POLICY_URL+"?rand="+Math.random();$.getJSON(url,{filename:file.name},function(data){$.log("got params for "+data.item_id),me.fileParamsReceived+=1,me.fileToData[file.id].itemId=data.item_id,me.fileToData[file.id].key=data.key,$.each(data,function(key,val){$.log("adding file parameter: "+key+" "+val),me.swfuploader.addFileParam(file.id,key,val)}),$.log("adding file to pending uploads queue"),me.uploadQueue.queue("pendingUploads",function(){$.log("starting upload for "+file.name),me.uploadInProgress=!0,me.swfuploader.startUpload(file.id)}),me.tryTriggerUpload()}).error(function(){count>me.MAX_ERROR_RETRY_COUNT?($.log("getting file policy failed"),me.uploadReallyError(file)):($.log("error while trying to get the file policy from the server. will try again in "+2*delay+"s"),$.doTimeout(delay,function(){return me.fileQueued(file,2*delay,count+1),!1}))})},this.fileQueueError=function(file,errorCode){(errorCode==SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED||errorCode==SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT)&&me.events.trigger("onLimitExceeded",errorCode,me.getEventData())},this.uploadStart=function(file){$.log("starting to upload file: "+file.name);var url=this.UPLOAD_START_URL.replace("{{ALBUM_ID}}",this.albumId);return url=url.replace("{{ITEM_ID}}",this.fileToData[file.id].itemId),$.post(url),this.events.trigger("onFileUploadStart",_.extend({file:file},this.getEventData())),!0},this.uploadSuccessHelper=function(url,data,file,delay,count){var me=this;$.post(url,data).success(function(){me.uploadReallySuccess(file),_gaq.push(["_trackEvent","Image upload","Upload image succeed","Upload succeed in "+count+" sending uploadComplete to server."])}).error(function(){$.log("error while sending uploadComplete to server. will try again in "+2*delay+"s"),count>me.MAX_ERROR_RETRY_COUNT?($.log("upload failed"),me.fileToData[file.id].errorCode=-1,me.uploadReallyError(file)):$.doTimeout(delay,function(){return me.uploadSuccessHelper(url,data,file,2*delay,count+1),!1})})},this.uploadSuccess=function(file){$.log("successfully uploaded: "+file.name);var url=this.UPLOAD_COMPLETE_URL.replace("{{ALBUM_ID}}",this.albumId);return url=url.replace("{{ITEM_ID}}",this.fileToData[file.id].itemId),this.uploadSuccessHelper(url,{key:this.fileToData[file.id].key},file,1e3,1),!0},this.uploadError=function(file,errorCode,message,delay,count){var me=this;if(errorCode==SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED&&alert("Error, file is more then 50 MB."),!file)return $.log("upload error on null. what can I do!?"),!1;$.log("possible error uploading : "+file.name+" "+errorCode+" "+message),me.fileToData[file.id].hasError=!0,me.fileToData[file.id].errorCode=errorCode;var url=this.UPLOAD_COMPLETE_URL.replace("{{ALBUM_ID}}",this.albumId);return url=url.replace("{{ITEM_ID}}",this.fileToData[file.id].itemId),$.post(url,{key:this.fileToData[file.id].key}).success(function(data){"processing"==data.status?($.log("upload ok for file "+file.name+", now processing file"),me.fileToData[file.id].hasError=!1,me.uploadReallySuccess(file)):($.log("- upload failed on file: "+file.name+" error: "+errorCode),me.uploadReallyError(file))}).error(function(){$.log("error while sending uploadComplete to server. will try again in "+2*delay+"s"),count>me.MAX_ERROR_RETRY_COUNT?($.log("upload failed on file: "+file.name+" error: "+errorCode),me.uploadReallyError(file)):$.doTimeout(delay,function(){return me.uploadError(file,errorCode,message,2*delay,count+1),!1})}),!0},this.uploadComplete=function(file){$.log("finished uploading file: "+file.name),this.filesUploaded+=1,this.uploadInProgress=!1,$.inArray(file.id,this.completedUploads)<0&&(this.uploadBytes+=file.size,this.completedUploads.push(file.id));var me=this;return this.events.trigger("onFileUploadComplete",_.extend({file:file},this.getEventData())),$.doTimeout(100,function(){return me.tryTriggerUpload(),!1}),!0},this.uploadreallyComplete=function(){var me=this;if(this.filesReallyUploaded+=1,this.filesReallyUploaded==this.filesEnqueud){$.log("finished uploading all files");var url=this.ALBUM_END_URL.replace("{{ALBUM_ID}}",this.albumId);$.post(url),me.events.trigger("onAllFilesCompleted",me.getEventData()),$.doTimeout("albumProgressUpdateTimer",this.ALBUM_PROGRESS_UPDATE_TIMER,function(){return me.updateAlbumProgress(),_.indexOf(["SUCCESS","ERROR"],me.processingStatus)>=0?(me.events.trigger("onProcessingComplete",me.getEventData()),!1):!0})}return!0},this.uploadProgress=function(file,bytes,total){this.events.trigger("onFileUploadProgress",_.extend({file:file,bytes:bytes,total:total},this.getEventData()));var totalUploaded=0;total>bytes?totalUploaded=this.uploadBytes+bytes:bytes===total&&($.inArray(file.id,this.completedUploads)<0&&(this.uploadBytes+=total,this.completedUploads.push(file.id)),totalUploaded=this.uploadBytes),this.events.trigger("onTotalUploadProgress",_.extend({bytes:totalUploaded,total:this.totalBytes},this.getEventData()))},this.uploadReallySuccess=function(file){this.filesUploadedSuccess+=1,me.uploadreallyComplete(file),this.fileToData[file.id].uploadAttempts>0&&($.log("Upload image succeed after error","Upload succeed after "+this.fileToData[file.id].uploadAttempts+" attempts."),_gaq.push(["_trackEvent","Image upload","Upload image succeed after error","Upload succeed after "+this.fileToData[file.id].uploadAttempts+" attemppts."])),this.events.trigger("onFileUploadSuccess",_.extend({file:file},this.getEventData()))},this.uploadReallyError=function(file){var errorCode=this.fileToData[file.id].errorCode;if(!errorCode||errorCode!==SWFUpload.UPLOAD_ERROR.HTTP_ERROR&&errorCode!==SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED&&errorCode!==SWFUpload.UPLOAD_ERROR.IO_ERROR)$.log("Upload failed. Error not handel. errorCode:"+errorCode),_gaq.push(["_trackEvent","Image upload","Upload image failure","Upload failed. Error not handel. errorCode:"+errorCode]);else{if(me.fileToData[file.id].uploadAttempts<me.MAX_UPLOAD_RETRY_COUNT)return $.log("upload error. add to pendingUploads"),me.fileToData[file.id].uploadAttempts+=1,me.uploadQueue.queue("pendingUploads",function(){$.log("Restart upload for "+file.name),me.uploadInProgress=!0,me.swfuploader.startUpload(file.id)}),void me.tryTriggerUpload();$.log("Upload failed after "+me.MAX_UPLOAD_RETRY_COUNT+" attempts. errorCode:"+errorCode),_gaq.push(["_trackEvent","Image upload","Upload image failure","Upload failed after "+me.MAX_UPLOAD_RETRY_COUNT+" attempts. errorCode:"+errorCode])}this.filesUploadedError+=1,me.uploadreallyComplete(file),this.events.trigger("onFileUploadError",_.extend({file:file},this.getEventData()))},this.updateAlbumProgress=function(){$.log("getting album status. disabled.");var url=this.ALBUM_STATUS_URL.replace("{{ALBUM_ID}}",this.albumId);url+="?rand="+Math.random();var me=this;$.getJSON(url,function(data){$.log("updating progress bars"),me.filesProcessedSuccess=data.photo_count,me.filesProcessedError=data.error_count,me.processingStatus=data.processing_status,me.totalProcessed=me.filesProcessedSuccess+me.filesProcessedError})},this.getEventData=function(){return{albumId:this.albumId,processingStatus:this.processingStatus,fileParamsReceived:this.fileParamsReceived,filesEnqueud:this.filesEnqueud,filesUploaded:this.filesUploaded,filesUploadedSuccess:this.filesUploadedSuccess,filesUploadedError:this.filesUploadedError,filesProcessedSuccess:this.filesProcessedSuccess,filesProcessedError:this.filesProcessedError,totalProcessed:this.totalProcessed,uploadInProgress:this.uploadInProgress}},this.setAlbumName=function(name){var url=this.ALBUM_STATUS_URL.replace("{{ALBUM_ID}}",this.albumId);$.post(url,{name:name})}}window.log=function(){log.history=log.history||[],log.history.push(arguments),arguments.callee=arguments.callee.caller,this.console&&console.log(Array.prototype.slice.call(arguments))},function(b){function c(){}for(var a,d="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(",");a=d.pop();)b[a]=b[a]||c}(window.console=window.console||{}),function($){$.extend({_debug$:null,debug:function(onoff){var old_value=1==$._debug$?!0:!1;return $._debug$=onoff?!0:!1,old_value},log:function(message){1==$._debug$&&window.console.debug(message)}}),$.fn.extend({log:function(message){return 1==$._debug$?this.each(function(){"undefined"!=typeof message&&$.log(message),$.log(this)}):void 0}}),$(document).ready(function(){var req=$("html").attr("debug");("true"==req||"false"==req)&&$.debug("true"==req?!0:!1)}),$(document).ready(function(){function object2text(obj){var text=null;if("undefined"==typeof obj)text="[undefined]";else if("boolean"==typeof obj)text=obj?"true":"false";else if("number"==typeof obj)text=""+obj;else if("string"==typeof obj)text=obj;else if("function"==typeof obj)text=obj;else if("object"==typeof obj)if("undefined"!=typeof obj.nodeType)if(1==obj.nodeType){text="&lt;",text+=obj.nodeName.toLowerCase();for(var i=0;i<obj.attributes.length;i++)text+=" "+obj.attributes[i].nodeName.toLowerCase()+'="'+obj.attributes[i].nodeValue+'"';text+="&gt;"}else 2==obj.nodeType?text=obj.nodeName+'="'+obj.nodeValue:3==obj.nodeType&&(text=obj.nodeValue);else"undefined"!=typeof obj.toJSONString?text=obj.toJSONString():"undefined"!=typeof obj.toString&&(text=obj.toString());return null==text&&(text="[unknown]"),text}if("undefined"==typeof window.console){$(document).ready(function(){$("body").append('<div id="jQueryDebug"><ol></ol></div>'),$("#jQueryDebug").css("display","none").css("fontFamily","monospace").css("backgroundColor","#ffffff").css("color","#000000").css("padding","10px 0px 10px 0px").css("border","4px solid #666699").css("margin","4px 4px 4px 4px"),$("#jQueryDebug ol").css("margin","0px 0px 0px 0px").css("paddingRight","20px")});var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"],logfunc=function(msg){$("#jQueryDebug").css("display",1==$._debug$?"block":"none"),$("#jQueryDebug ol").append("<li>"+object2text(msg)+"</li>"),$("#jQueryDebug ol li").css("borderBottom","1px solid #cccccc").css("padding","1px 10px 1px 10px")};window.console={};for(var i=0;i<names.length;i++)window.console[names[i]]=logfunc;window.console.jQueryDebug=!0}})}(jQuery),function($){$.fn.extend({myBeforeAfter:function(options){var defaults={animateIntro:!0,introDelay:1e3,introDuration:1e3,showFullLinks:!0,showWaterMarks:!0,showSmallWaterMarks:!1,showTinyWaterMarks:!1,imagePath:"/js/beforeAfter/",waterMarkTopOffset:51},options=$.extend(defaults,options);return this.each(function(){function animateIntro(registerHandler){$after.css("clip",["rect(0px ",imgWidth,"px ",imgHeight,"px 0px)"].join("")),$dragwrapper.css("left",imgWidth-$dragwrapper.width()/2+"px"),setTimeout(function(){$dragwrapper.animate({left:imgWidth/2-$dragwrapper.width()/2+"px"},{duration:o.introDuration,step:animateClipRight,complete:function(){registerHandler&&clickit()}})},o.introDelay)}function animateClipRight(now){$after.css("clip",["rect(0px ",now,"px ",imgHeight,"px 0px)"].join("")),$beforeWatermark.width(Math.max(0,now-halfWndWidth+waterMarkWidth))}function clickit(){function handleClick(context,ev){var posx=0,e=ev;e||(e=window.event),e.pageX||e.pageY?posx=e.pageX:(e.clientX||e.clientY)&&(posx=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);for(var clickX=posx,op=context.offsetParent;op;)clickX-=op.offsetLeft,op=op.offsetParent;var parentCSSoffset=parseInt($(context).css("left").match(/\d+/))||0,offset=clickX-$dragwrapper.width()/2-parentCSSoffset-(47-$dragwrapper.width()/2);o.cursorOffset&&(offset+=o.cursorOffset),$dragwrapper.css("left",offset+"px"),animateClipRight(offset)}$(obj).mousemove(function(e){handleClick(this,e)})}var o=options,obj=$(this);obj.attr("width")&&(options.imgWidth=parseInt(obj.attr("width"))),obj.attr("height")&&(options.imgHeight=parseInt(obj.attr("height")));var randID=Math.round(1e8*Math.random()),scale1=options.wndWidth/options.imgWidth,scale2=options.wndHeight/options.imgHeight,scale=Math.max(scale1,scale2),scaledImageWidth=options.imgWidth*scale,scaledImageHeight=options.imgHeight*scale;obj.find("img").width(scaledImageWidth).height(scaledImageHeight);var imgWidth=scaledImageWidth,imgHeight=scaledImageHeight,topOffset=(options.wndHeight-options.imgHeight*scale)/2,leftOffset=(options.wndWidth-options.imgWidth*scale)/2,halfWndWidth=options.wndWidth/2;$(obj).css({overflow:"hidden",position:"relative"});var $before=$("img:first",obj),$after=$("img:last",obj);$before.addClass("baimage babefore"),$after.addClass("baimage beafter"),$after.css("clip",["rect(0px ",imgWidth/2,"px ",imgHeight,"px 0px)"].join(""));var i=0,html=[];html[i++]='<div id="dragwrapper'+randID+'" class="badragwrapper">',html[i++]='<div id="drag'+randID+'" class="badrag">',html[i++]="</div>",html[i++]="</div>";$(obj).prepend(html.join(""));$("#drag"+randID).width(9).height(options.wndHeight),i=0,html=[],html[i++]='<div id="imagePairsCropper'+randID+'" class="baCropper" style="overflow:hidden;width:'+options.wndWidth+"px;height:"+options.wndHeight+'px;position:relative;">',html[i++]='<div id="imagePairsPositioner'+randID+'" class="baPositioner" style="position:relative;top:'+topOffset+"px; left:"+leftOffset+'px;">',html[i++]="</div>",html[i++]="</div>",$(obj).wrapInner(html.join("")),$before.after('<div class="baInnerShadow" style="top:'+-topOffset+'px;"></div>'),$before.after('<div class="baInnerShadowBottom" style="top:'+(-topOffset+options.wndHeight-5)+'px;"></div>'),$before.after('<div class="baInnerShadowRight" style="top:'+-topOffset+"px; height:"+options.wndHeight+"px; left:"+(options.wndWidth-5)+'px;"></div>');var waterMarkWidth=315,waterMarkHeight=51;o.showWaterMarks?($after.after('<div class="baBeforeWaterMark" style="top:'+(-topOffset+o.waterMarkTopOffset)+"px; width: "+waterMarkWidth+"px; height: "+waterMarkHeight+'px;"></div>'),$after.before('<div class="baAfterWaterMark" style="top:'+(-topOffset+o.waterMarkTopOffset)+"px; width: "+waterMarkWidth+"px; height: "+waterMarkHeight+'px;"></div>')):o.showSmallWaterMarks?(waterMarkWidth=216,waterMarkHeight=35,$after.after('<div class="baBeforeWaterMark baBeforeSmallWaterMark" style="top:'+(-topOffset+o.waterMarkTopOffset)+"px; width: "+waterMarkWidth+"px; height: "+waterMarkHeight+'px;"></div>'),$after.before('<div class="baAfterWaterMark baAfterSmallWaterMark" style="top:'+(-topOffset+o.waterMarkTopOffset)+"px; width: "+waterMarkWidth+"px; height: "+waterMarkHeight+'px;"></div>')):o.showTinyWaterMarks&&(waterMarkWidth=150,waterMarkHeight=24,$after.after('<div class="baBeforeWaterMark baBeforeTinyWaterMark" style="top:'+(-topOffset+o.waterMarkTopOffset)+"px; width: "+waterMarkWidth+"px; height: "+waterMarkHeight+'px;"></div>'),$after.before('<div class="baAfterWaterMark baAfterTinyWaterMark" style="top:'+(-topOffset+o.waterMarkTopOffset)+"px; width: "+waterMarkWidth+"px; height: "+waterMarkHeight+'px;"></div>'));{var $afterWatermark=$(".baAfterWaterMark"),$beforeWatermark=$(".baBeforeWaterMark"),$dragwrapper=$("#dragwrapper"+randID);$afterWatermark.width()/2}$afterWatermark.css("left",-leftOffset+halfWndWidth),$beforeWatermark.css("left",-leftOffset+halfWndWidth-$afterWatermark.width()),o.showFullLinks&&($(obj).after('<div class="balinks" id="links'+randID+'"><span class="bflinks"><a class="bashowleft" id="showleft'+randID+'" href="javascript:void(0)">Show only before</a></span><span class="bflinks"><a class="bashowright" id="showright'+randID+'" href="javascript:void(0)">Show only after</a></span></div>'),$("#links"+randID).width(imgWidth),$("#showleft"+randID).click(function(){$after.css("clip",["rect(0px 0px ",imgHeight,"px 0px)"].join("")),$dragwrapper.animate({left:"0px"},200)}),$("#showright"+randID).click(function(){$after.css("clip",["rect(0px ",imgWidth,"px ",imgHeight,"px 0px)"].join("")),$dragwrapper.animate({left:imgWidth-$dragwrapper.width()+"px"},200)}));{var barOffset=$dragwrapper.offset();barOffset.left}o.animateIntro?animateIntro(!0):clickit()})}})}(jQuery),function($){"$:nomunge";function p_doTimeout(jquery_data_key){function cleanup(){jquery_data_key?elem.removeData(jquery_data_key):id&&delete cache[id]}function actually_setTimeout(){data.id=setTimeout(function(){data.fn()},delay)}var elem,that=this,data={},method_base=jquery_data_key?$.fn:$,args=arguments,slice_args=4,id=args[1],delay=args[2],callback=args[3];if("string"!=typeof id&&(slice_args--,id=jquery_data_key=0,delay=args[1],callback=args[2]),jquery_data_key?(elem=that.eq(0),elem.data(jquery_data_key,data=elem.data(jquery_data_key)||{})):id&&(data=cache[id]||(cache[id]={})),data.id&&clearTimeout(data.id),delete data.id,callback)data.fn=function(no_polling_loop){"string"==typeof callback&&(callback=method_base[callback]),callback.apply(that,aps.call(args,slice_args))!==!0||no_polling_loop?cleanup():actually_setTimeout()},actually_setTimeout();else{if(data.fn)return void 0===delay?cleanup():data.fn(delay===!1),!0;cleanup()}}var cache={},doTimeout="doTimeout",aps=Array.prototype.slice;$[doTimeout]=function(){return p_doTimeout.apply(window,[0].concat(aps.call(arguments)))},$.fn[doTimeout]=function(){var args=aps.call(arguments),result=p_doTimeout.apply(this,[doTimeout+args[0]].concat(args));return"number"==typeof args[0]||"number"==typeof args[1]?this:result}}(jQuery),function($){$.extend({password:function(length,special){var randomNumber,iteration=0,password="";if(void 0==length)var length=8;if(void 0==special)var special=!1;for(;length>iteration;){if(randomNumber=Math.floor(100*Math.random())%94+33,!special){if(randomNumber>=33&&47>=randomNumber)continue;if(randomNumber>=58&&64>=randomNumber)continue;if(randomNumber>=91&&96>=randomNumber)continue;if(randomNumber>=123&&126>=randomNumber)continue}iteration++,password+=String.fromCharCode(randomNumber)}return password}})}(jQuery),function($){$.extend($.fn,{validate:function(options){if(!this.length)return void(options&&options.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing"));var validator=$.data(this[0],"validator");return validator?validator:(validator=new $.validator(options,this[0]),$.data(this[0],"validator",validator),validator.settings.onsubmit&&(this.find("input, button").filter(".cancel").click(function(){validator.cancelSubmit=!0}),validator.settings.submitHandler&&this.find("input, button").filter(":submit").click(function(){validator.submitButton=this}),this.submit(function(event){function handle(){if(validator.settings.submitHandler){if(validator.submitButton)var hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val(validator.submitButton.value).appendTo(validator.currentForm);return validator.settings.submitHandler.call(validator,validator.currentForm),validator.submitButton&&hidden.remove(),!1}return!0}return validator.settings.debug&&event.preventDefault(),validator.cancelSubmit?(validator.cancelSubmit=!1,handle()):validator.form()?validator.pendingRequest?(validator.formSubmitted=!0,!1):handle():(validator.focusInvalid(),!1)})),validator)},valid:function(){if($(this[0]).is("form"))return this.validate().form();var valid=!0,validator=$(this[0].form).validate();return this.each(function(){valid&=validator.element(this)}),valid},removeAttrs:function(attributes){var result={},$element=this;return $.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value),$element.removeAttr(value)}),result},rules:function(command,argument){var element=this[0];if(command){var settings=$.data(element.form,"validator").settings,staticRules=settings.rules,existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument)),staticRules[element.name]=existingRules,argument.messages&&(settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages));break;case"remove":if(!argument)return delete staticRules[element.name],existingRules;var filtered={};return $.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method],delete existingRules[method]}),filtered}}var data=$.validator.normalizeRules($.extend({},$.validator.metadataRules(element),$.validator.classRules(element),$.validator.attributeRules(element),$.validator.staticRules(element)),element);if(data.required){var param=data.required;delete data.required,data=$.extend({required:param},data)}return data}}),$.extend($.expr[":"],{blank:function(a){return!$.trim(""+a.value)},filled:function(a){return!!$.trim(""+a.value)},unchecked:function(a){return!a.checked}}),$.validator=function(options,form){this.settings=$.extend(!0,{},$.validator.defaults,options),this.currentForm=form,this.init()},$.validator.format=function(source,params){return 1==arguments.length?function(){var args=$.makeArray(arguments);return args.unshift(source),$.validator.format.apply(this,args)}:(arguments.length>2&&params.constructor!=Array&&(params=$.makeArray(arguments).slice(1)),params.constructor!=Array&&(params=[params]),$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),n)}),source)},$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:!0,ignore:[],ignoreTitle:!1,onfocusin:function(element){this.lastActive=element,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(element)).hide())},onfocusout:function(element){this.checkable(element)||!(element.name in this.submitted)&&this.optional(element)||this.element(element)},onkeyup:function(element){(element.name in this.submitted||element==this.lastElement)&&this.element(element)},onclick:function(element){element.name in this.submitted?this.element(element):element.parentNode.name in this.submitted&&this.element(element.parentNode)},highlight:function(element,errorClass,validClass){"radio"===element.type?this.findByName(element.name).addClass(errorClass).removeClass(validClass):$(element).addClass(errorClass).removeClass(validClass)},unhighlight:function(element,errorClass,validClass){"radio"===element.type?this.findByName(element.name).removeClass(errorClass).addClass(validClass):$(element).removeClass(errorClass).addClass(validClass)}},setDefaults:function(settings){$.extend($.validator.defaults,settings)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function delegate(event){var validator=$.data(this[0].form,"validator"),eventType="on"+event.type.replace(/^validate/,"");validator.settings[eventType]&&validator.settings[eventType].call(validator,this[0])}this.labelContainer=$(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm),this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var groups=this.groups={};$.each(this.settings.groups,function(key,value){$.each(value.split(/\s/),function(index,name){groups[name]=key})});var rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value)}),$(this.currentForm).validateDelegate(":text, :password, :file, select, textarea","focusin focusout keyup",delegate).validateDelegate(":radio, :checkbox, select, option","click",delegate),this.settings.invalidHandler&&$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),$.extend(this.submitted,this.errorMap),this.invalid=$.extend({},this.errorMap),this.valid()||$(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var i=0,elements=this.currentElements=this.elements();elements[i];i++)this.check(elements[i]);return this.valid()},element:function(element){element=this.clean(element),this.lastElement=element,this.prepareElement(element),this.currentElements=$(element);var result=this.check(element);return result?delete this.invalid[element.name]:this.invalid[element.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),result},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors),this.errorList=[];for(var name in errors)this.errorList.push({message:errors[name],element:this.findByName(name)[0]});this.successList=$.grep(this.successList,function(element){return!(element.name in errors)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){$.fn.resetForm&&$(this.currentForm).resetForm(),this.submitted={},this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(obj){var count=0;for(var i in obj)count++;return count},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return 0==this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}},findLastActive:function(){var lastActive=this.lastActive;
return lastActive&&1==$.grep(this.errorList,function(n){return n.element.name==lastActive.name}).length&&lastActive},elements:function(){var validator=this,rulesCache={};return $(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&validator.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in rulesCache||!validator.objectLength($(this).rules())?!1:(rulesCache[this.name]=!0,!0)})},clean:function(selector){return $(selector)[0]},errors:function(){return $(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=$([]),this.toHide=$([]),this.currentElements=$([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(element){this.reset(),this.toHide=this.errorsFor(element)},check:function(element){element=this.clean(element),this.checkable(element)&&(element=this.findByName(element.name).not(this.settings.ignore)[0]);var rules=$(element).rules(),dependencyMismatch=!1;for(var method in rules){var rule={method:method,parameters:rules[method]};try{var result=$.validator.methods[method].call(this,element.value.replace(/\r/g,""),element,rule.parameters);if("dependency-mismatch"==result){dependencyMismatch=!0;continue}if(dependencyMismatch=!1,"pending"==result)return void(this.toHide=this.toHide.not(this.errorsFor(element)));if(!result)return this.formatAndAdd(element,rule),!1}catch(e){throw this.settings.debug&&window.console&&console.log("exception occured when checking element "+element.id+", check the '"+rule.method+"' method",e),e}}return dependencyMismatch?void 0:(this.objectLength(rules)&&this.successList.push(element),!0)},customMetaMessage:function(element,method){if($.metadata){var meta=this.settings.meta?$(element).metadata()[this.settings.meta]:$(element).metadata();return meta&&meta.messages&&meta.messages[method]}},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor==String?m:m[method])},findDefined:function(){for(var i=0;i<arguments.length;i++)if(void 0!==arguments[i])return arguments[i];return void 0},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customMetaMessage(element,method),!this.settings.ignoreTitle&&element.title||void 0,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>")},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method),theregex=/\$?\{(\d+)\}/g;"function"==typeof message?message=message.call(this,rule.parameters,element):theregex.test(message)&&(message=jQuery.format(message.replace(theregex,"{$1}"),rule.parameters)),this.errorList.push({message:message,element:element}),this.errorMap[element.name]=message,this.submitted[element.name]=message},addWrapper:function(toToggle){return this.settings.wrapper&&(toToggle=toToggle.add(toToggle.parent(this.settings.wrapper))),toToggle},defaultShowErrors:function(){for(var i=0;this.errorList[i];i++){var error=this.errorList[i];this.settings.highlight&&this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass),this.showLabel(error.element,error.message)}if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(var i=0;this.successList[i];i++)this.showLabel(this.successList[i]);if(this.settings.unhighlight)for(var i=0,elements=this.validElements();elements[i];i++)this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return $(this.errorList).map(function(){return this.element})},showLabel:function(element,message){var label=this.errorsFor(element);label.length?(label.removeClass().addClass(this.settings.errorClass),label.attr("generated")&&label.html(message)):(label=$("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(element),generated:!0}).addClass(this.settings.errorClass).html(message||""),this.settings.wrapper&&(label=label.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(label).length||(this.settings.errorPlacement?this.settings.errorPlacement(label,$(element)):label.insertAfter(element))),!message&&this.settings.success&&(label.text(""),"string"==typeof this.settings.success?label.addClass(this.settings.success):this.settings.success(label)),this.toShow=this.toShow.add(label)},errorsFor:function(element){var name=this.idOrName(element);return this.errors().filter(function(){return $(this).attr("for")==name})},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name)},checkable:function(element){return/radio|checkbox/i.test(element.type)},findByName:function(name){var form=this.currentForm;return $(document.getElementsByName(name)).map(function(index,element){return element.form==form&&element.name==name&&element||null})},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case"select":return $("option:selected",element).length;case"input":if(this.checkable(element))return this.findByName(element.name).filter(":checked").length}return value.length},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):!0},dependTypes:{"boolean":function(param){return param},string:function(param,element){return!!$(param,element.form).length},"function":function(param,element){return param(element)}},optional:function(element){return!$.validator.methods.required.call(this,$.trim(element.value),element)&&"dependency-mismatch"},startRequest:function(element){this.pending[element.name]||(this.pendingRequest++,this.pending[element.name]=!0)},stopRequest:function(element,valid){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[element.name],valid&&0==this.pendingRequest&&this.formSubmitted&&this.form()?($(this.currentForm).submit(),this.formSubmitted=!1):!valid&&0==this.pendingRequest&&this.formSubmitted&&($(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",{old:null,valid:!0,message:this.defaultMessage(element,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},dateDE:{dateDE:!0},number:{number:!0},numberDE:{numberDE:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(className,rules){className.constructor==String?this.classRuleSettings[className]=rules:$.extend(this.classRuleSettings,className)},classRules:function(element){var rules={},classes=$(element).attr("class");return classes&&$.each(classes.split(" "),function(){this in $.validator.classRuleSettings&&$.extend(rules,$.validator.classRuleSettings[this])}),rules},attributeRules:function(element){var rules={},$element=$(element);for(var method in $.validator.methods){var value=$element.attr(method);value&&(rules[method]=value)}return rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength)&&delete rules.maxlength,rules},metadataRules:function(element){if(!$.metadata)return{};var meta=$.data(element.form,"validator").settings.meta;return meta?$(element).metadata()[meta]:$(element).metadata()},staticRules:function(element){var rules={},validator=$.data(element.form,"validator");return validator.settings.rules&&(rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{}),rules},normalizeRules:function(rules,element){return $.each(rules,function(prop,val){if(val===!1)return void delete rules[prop];if(val.param||val.depends){var keepRule=!0;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element)}keepRule?rules[prop]=void 0!==val.param?val.param:!0:delete rules[prop]}}),$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter}),$.each(["minlength","maxlength","min","max"],function(){rules[this]&&(rules[this]=Number(rules[this]))}),$.each(["rangelength","range"],function(){rules[this]&&(rules[this]=[Number(rules[this][0]),Number(rules[this][1])])}),$.validator.autoCreateRanges&&(rules.min&&rules.max&&(rules.range=[rules.min,rules.max],delete rules.min,delete rules.max),rules.minlength&&rules.maxlength&&(rules.rangelength=[rules.minlength,rules.maxlength],delete rules.minlength,delete rules.maxlength)),rules.messages&&delete rules.messages,rules},normalizeRule:function(data){if("string"==typeof data){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=!0}),data=transformed}return data},addMethod:function(name,method,message){$.validator.methods[name]=method,$.validator.messages[name]=void 0!=message?message:$.validator.messages[name],method.length<3&&$.validator.addClassRules(name,$.validator.normalizeRule(name))},methods:{required:function(value,element,param){if(!this.depend(param,element))return"dependency-mismatch";switch(element.nodeName.toLowerCase()){case"select":var val=$(element).val();return val&&val.length>0;case"input":if(this.checkable(element))return this.getLength(value,element)>0;default:return $.trim(value).length>0}},remote:function(value,element,param){if(this.optional(element))return"dependency-mismatch";var previous=this.previousValue(element);if(this.settings.messages[element.name]||(this.settings.messages[element.name]={}),previous.originalMessage=this.settings.messages[element.name].remote,this.settings.messages[element.name].remote=previous.message,param="string"==typeof param&&{url:param}||param,this.pending[element.name])return"pending";if(previous.old===value)return previous.valid;previous.old=value;var validator=this;this.startRequest(element);var data={};return data[element.name]=value,$.ajax($.extend(!0,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,success:function(response){validator.settings.messages[element.name].remote=previous.originalMessage;var valid=response===!0;if(valid){var submitted=validator.formSubmitted;validator.prepareElement(element),validator.formSubmitted=submitted,validator.successList.push(element),validator.showErrors()}else{var errors={},message=response||validator.defaultMessage(element,"remote");errors[element.name]=previous.message=$.isFunction(message)?message(value):message,validator.showErrors(errors)}previous.valid=valid,validator.stopRequest(element,valid)}},param)),"pending"},minlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)>=param},maxlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)<=param},rangelength:function(value,element,param){var length=this.getLength($.trim(value),element);return this.optional(element)||length>=param[0]&&length<=param[1]},min:function(value,element,param){return this.optional(element)||value>=param},max:function(value,element,param){return this.optional(element)||param>=value},range:function(value,element,param){return this.optional(element)||value>=param[0]&&value<=param[1]},email:function(value,element){return this.optional(element)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(value)},url:function(value,element){return this.optional(element)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value)},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value))},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(value)},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(value)},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value)},creditcard:function(value,element){if(this.optional(element))return"dependency-mismatch";if(/[^0-9-]+/.test(value))return!1;var nCheck=0,nDigit=0,bEven=!1;value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n),nDigit=parseInt(cDigit,10);bEven&&(nDigit*=2)>9&&(nDigit-=9),nCheck+=nDigit,bEven=!bEven}return nCheck%10==0},accept:function(value,element,param){return param="string"==typeof param?param.replace(/,/g,"|"):"png|jpe?g|gif",this.optional(element)||value.match(new RegExp(".("+param+")$","i"))},equalTo:function(value,element,param){var target=$(param).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){$(element).valid()});return value==target.val()}}}),$.format=$.validator.format}(jQuery),function($){var pendingRequests={};if($.ajaxPrefilter)$.ajaxPrefilter(function(settings,_,xhr){var port=settings.port;"abort"==settings.mode&&(pendingRequests[port]&&pendingRequests[port].abort(),pendingRequests[port]=xhr)});else{var ajax=$.ajax;$.ajax=function(settings){var mode=("mode"in settings?settings:$.ajaxSettings).mode,port=("port"in settings?settings:$.ajaxSettings).port;return"abort"==mode?(pendingRequests[port]&&pendingRequests[port].abort(),pendingRequests[port]=ajax.apply(this,arguments)):ajax.apply(this,arguments)}}}(jQuery),function($){jQuery.event.special.focusin||jQuery.event.special.focusout||!document.addEventListener||$.each({focus:"focusin",blur:"focusout"},function(original,fix){function handler(e){return e=$.event.fix(e),e.type=fix,$.event.handle.call(this,e)}$.event.special[fix]={setup:function(){this.addEventListener(original,handler,!0)},teardown:function(){this.removeEventListener(original,handler,!0)},handler:function(e){return arguments[0]=$.event.fix(e),arguments[0].type=fix,$.event.handle.apply(this,arguments)}}}),$.extend($.fn,{validateDelegate:function(delegate,type,handler){return this.bind(type,function(event){var target=$(event.target);return target.is(delegate)?handler.apply(target,arguments):void 0})}})}(jQuery),function($){var Range=function(x1,y1,x2,y2){this.x1=x1,this.x2=x2,this.y1=y1,this.y2=y2};Range.prototype.contains=function(range){return this.x1<=range.x1&&range.x2<=this.x2&&this.y1<=range.y1&&range.y2<=this.y2},Range.prototype.transform=function(x,y){return new Range(this.x1+x,this.y1+y,this.x2+x,this.y2+y)},$.fn.positionBy=function(args){new Date;if(0==this.length)return this;var args=$.extend({target:null,targetPos:null,elementPos:null,x:null,y:null,positions:null,addClass:!1,force:!1,container:window,hideAfterPosition:!1},args);if(null!=args.x)var tLeft=args.x,tTop=args.y,tWidth=0,tHeight=0;else var $target=$($(args.target)[0]),tWidth=$target.outerWidth(),tHeight=$target.outerHeight(),tOffset=$target.offset(),tLeft=tOffset.left,tTop=tOffset.top;var tRight=tLeft+tWidth,tBottom=tTop+tHeight;return this.each(function(){var $element=$(this);$element.is(":visible")||$element.css({left:-3e3,top:-3e3}).show();var eWidth=$element.outerWidth(),eHeight=$element.outerHeight(),position=[],next=[];if(position[0]=new Range(tRight,tTop,tRight+eWidth,tTop+eHeight),next[0]=[1,7,4],position[1]=new Range(tRight,tBottom-eHeight,tRight+eWidth,tBottom),next[1]=[0,6,4],position[2]=new Range(tRight,tBottom,tRight+eWidth,tBottom+eHeight),next[2]=[1,3,10],position[3]=new Range(tRight-eWidth,tBottom,tRight,tBottom+eHeight),next[3]=[1,6,10],position[4]=new Range(tLeft,tBottom,tLeft+eWidth,tBottom+eHeight),next[4]=[1,6,9],position[5]=new Range(tLeft-eWidth,tBottom,tLeft,tBottom+eHeight),next[5]=[6,4,9],position[6]=new Range(tLeft-eWidth,tBottom-eHeight,tLeft,tBottom),next[6]=[7,1,4],position[7]=new Range(tLeft-eWidth,tTop,tLeft,tTop+eHeight),next[7]=[6,0,4],position[8]=new Range(tLeft-eWidth,tTop-eHeight,tLeft,tTop),next[8]=[7,9,4],position[9]=new Range(tLeft,tTop-eHeight,tLeft+eWidth,tTop),next[9]=[0,7,4],position[10]=new Range(tRight-eWidth,tTop-eHeight,tRight,tTop),next[10]=[0,7,3],position[11]=new Range(tRight,tTop-eHeight,tRight+eWidth,tTop),next[11]=[0,10,3],position[12]=new Range(tRight-eWidth,tTop,tRight,tTop+eHeight),next[12]=[13,7,10],position[13]=new Range(tRight-eWidth,tBottom-eHeight,tRight,tBottom),next[13]=[12,6,3],position[14]=new Range(tLeft,tBottom-eHeight,tLeft+eWidth,tBottom),next[14]=[15,1,4],position[15]=new Range(tLeft,tTop,tLeft+eWidth,tTop+eHeight),next[15]=[14,0,9],null!==args.positions)var pos=args.positions[0];else if(null!=args.targetPos&&null!=args.elementPos){var pos=[];pos[0]=[],pos[0][0]=15,pos[0][1]=7,pos[0][2]=8,pos[0][3]=9,pos[1]=[],pos[1][0]=0,pos[1][1]=12,pos[1][2]=10,pos[1][3]=11,pos[2]=[],pos[2][0]=2,pos[2][1]=3,pos[2][2]=13,pos[2][3]=1,pos[3]=[],pos[3][0]=4,pos[3][1]=5,pos[3][2]=6,pos[3][3]=14;var pos=pos[args.targetPos][args.elementPos]}var ePos=position[pos];if(!args.force){$window=$(window);var stack,sx=$window.scrollLeft(),sy=$window.scrollTop(),container=new Range(sx,sy,sx+$window.width(),sy+$window.height());stack=args.positions?args.positions:[pos];for(var test=[];stack.length>0;){var p=stack.shift();if(!test[p]){if(test[p]=!0,container.contains(position[p])){ePos=position[p];break}null===args.positions&&(stack=jQuery.merge(stack,next[p]))}}}$element.parents().each(function(){var $this=$(this);if("static"!=$this.css("position")){var abs=$this.offset();return ePos=ePos.transform(-abs.left,-abs.top),!1}});var css={left:ePos.x1,top:ePos.y1};args.hideAfterPosition&&(css.display="none"),$element.css(css),args.addClass&&$element.removeClass("positionBy0 positionBy1 positionBy2 positionBy3 positionBy4 positionBy5 positionBy6 positionBy7 positionBy8 positionBy9 positionBy10 positionBy11 positionBy12 positionBy13 positionBy14 positionBy15").addClass("positionBy"+p)})}}(jQuery),$(function(){$("ul.jd_menu").jdMenu()}),function($){function addEvents(ul){var settings=$.data($(ul).parents().andSelf().filter("ul.jd_menu")[0],"jdMenuSettings");$("> li",ul).bind("mouseenter.jdmenu mouseleave.jdmenu",function(evt){$(this).toggleClass("jdm_hover");var ul=$("> ul",this);if(1==ul.length){clearTimeout(this.$jdTimer);var enter="mouseenter"==evt.type,fn=enter?showMenu:hideMenu;this.$jdTimer=setTimeout(function(){fn(ul[0],settings.onAnimate,settings.isVertical)},enter?settings.showDelay:settings.hideDelay)}}).bind("click.jdmenu",function(evt){var ul=$("> ul",this);if(1==ul.length&&(1==settings.disableLinks||$(this).hasClass("accessible")))return showMenu(ul,settings.onAnimate,settings.isVertical),!1;if(evt.target==this){var link=$("> a",evt.target).not(".accessible");if(link.length>0){var a=link[0];a.onclick?$(a).trigger("click"):window.open(a.href,a.target||"_self")}}(settings.disableLinks||!settings.disableLinks&&!$(this).parent().hasClass("jd_menu"))&&($(this).parent().jdMenuHide(),evt.stopPropagation())}).find("> a").bind("focus.jdmenu blur.jdmenu",function(evt){var p=$(this).parents("li:eq(0)");"focus"==evt.type?p.addClass("jdm_hover"):p.removeClass("jdm_hover")}).filter(".accessible").bind("click.jdmenu",function(evt){evt.preventDefault()})}function showMenu(ul,animate,vertical){var ul=$(ul);if(!ul.is(":visible")){ul.bgiframe();var li=ul.parent();ul.trigger("jdMenuShow").positionBy({target:li[0],targetPos:vertical!==!0&&li.parent().hasClass("jd_menu")?3:1,elementPos:0,hideAfterPosition:!0,force:!0}),ul.hasClass("jdm_events")||(ul.addClass("jdm_events"),addEvents(ul)),li.addClass("jdm_active").siblings("li").find("> ul:eq(0):visible").each(function(){hideMenu(this)}),void 0===animate?ul.show():animate.apply(ul[0],[!0])}}function hideMenu(ul,animate){var ul=$(ul);$(".bgiframe",ul).remove(),ul.filter(":not(.jd_menu)").find("> li > ul:eq(0):visible").each(function(){hideMenu(this)}).end(),void 0===animate?ul.hide():animate.apply(ul[0],[!1]),ul.trigger("jdMenuHide").parents("li:eq(0)").removeClass("jdm_active jdm_hover").end().find("> li").removeClass("jdm_active jdm_hover")}$.fn.jdMenu=function(settings){var settings=$.extend({showDelay:200,hideDelay:500,disableLinks:!0},settings);return $.isFunction(settings.onAnimate)||(settings.onAnimate=void 0),this.filter("ul.jd_menu").each(function(){$.data(this,"jdMenuSettings",$.extend({isVertical:$(this).hasClass("jd_menu_vertical")},settings)),addEvents(this)})},$.fn.jdMenuUnbind=function(){$("ul.jdm_events",this).unbind(".jdmenu").find("> a").unbind(".jdmenu")},$.fn.jdMenuHide=function(){return this.filter("ul").each(function(){hideMenu(this)})},$(window).bind("click.jdmenu",function(){$("ul.jd_menu ul:visible").jdMenuHide()})}(jQuery),function($){$.fn.bgIframe=$.fn.bgiframe=function(s){if($.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)){s=$.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:!0,src:"javascript:false;"},s||{});var prop=function(n){return n&&n.constructor==Number?n+"px":n},style="display:block;position:absolute;z-index:-1;"+(s.opacity!==!1?"filter:Alpha(Opacity='0');":"")+"top:"+("auto"==s.top?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":prop(s.top))+";left:"+("auto"==s.left?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":prop(s.left))+";width:"+("auto"==s.width?"expression(this.parentNode.offsetWidth+'px')":prop(s.width))+";height:"+("auto"==s.height?"expression(this.parentNode.offsetHeight+'px')":prop(s.height))+";";return this.each(function(){if(0==$("> iframe.bgiframe",this).length){var iframe=document.createElement("iframe");iframe.setAttribute("class","bgiframe"),iframe.setAttribute("frameborder","0"),iframe.setAttribute("tabindex","-1"),iframe.setAttribute("src",s.src),iframe.setAttribute("style",style),this.insertBefore(iframe,this.firstChild)}})}return this}}(jQuery),new function(settings){var $separator=settings.separator||"&",$spaces=settings.spaces===!1?!1:!0,$prefix=(settings.suffix===!1?"":"[]",settings.prefix===!1?!1:!0),$hash=$prefix?settings.hash===!0?"#":"?":"",$numbers=settings.numbers===!1?!1:!0;jQuery.query=new function(){var is=function(o,t){return void 0!=o&&null!==o&&(t?o.constructor==t:!0)},parse=function(path){for(var m,rx=/\[([^[]*)\]/g,match=/^([^[]+)(\[.*\])?$/.exec(path),base=match[1],tokens=[];m=rx.exec(match[2]);)tokens.push(m[1]);return[base,tokens]},set=function(target,tokens,value){var token=tokens.shift();if("object"!=typeof target&&(target=null),""===token)if(target||(target=[]),is(target,Array))target.push(0==tokens.length?value:set(null,tokens.slice(0),value));else if(is(target,Object)){for(var i=0;null!=target[i++];);target[--i]=0==tokens.length?value:set(target[i],tokens.slice(0),value)}else target=[],target.push(0==tokens.length?value:set(null,tokens.slice(0),value));else if(token&&token.match(/^\s*[0-9]+\s*$/)){var index=parseInt(token,10);target||(target=[]),target[index]=0==tokens.length?value:set(target[index],tokens.slice(0),value)}else{if(!token)return value;var index=token.replace(/^\s*|\s*$/g,"");if(target||(target={}),is(target,Array)){for(var temp={},i=0;i<target.length;++i)temp[i]=target[i];target=temp}target[index]=0==tokens.length?value:set(target[index],tokens.slice(0),value)}return target},queryObject=function(a){var self=this;return self.keys={},a.queryObject?jQuery.each(a.get(),function(key,val){self.SET(key,val)}):jQuery.each(arguments,function(){var q=""+this;q=q.replace(/^[?#]/,""),q=q.replace(/[;&]$/,""),$spaces&&(q=q.replace(/[+]/g," ")),jQuery.each(q.split(/[&;]/),function(){var key=decodeURIComponent(this.split("=")[0]||""),val=decodeURIComponent(this.split("=")[1]||"");key&&($numbers&&(/^[+-]?[0-9]+\.[0-9]*$/.test(val)?val=parseFloat(val):/^[+-]?[0-9]+$/.test(val)&&(val=parseInt(val,10))),val=val||0===val?val:!0,val!==!1&&val!==!0&&"number"!=typeof val&&(val=val),self.SET(key,val))})}),self};return queryObject.prototype={queryObject:!0,has:function(key,type){var value=this.get(key);return is(value,type)},GET:function(key){if(!is(key))return this.keys;for(var parsed=parse(key),base=parsed[0],tokens=parsed[1],target=this.keys[base];null!=target&&0!=tokens.length;)target=target[tokens.shift()];return"number"==typeof target?target:target||""},get:function(key){var target=this.GET(key);return is(target,Object)?jQuery.extend(!0,{},target):is(target,Array)?target.slice(0):target},SET:function(key,val){var value=is(val)?val:null,parsed=parse(key),base=parsed[0],tokens=parsed[1],target=this.keys[base];return this.keys[base]=set(target,tokens.slice(0),value),this},set:function(key,val){return this.copy().SET(key,val)},REMOVE:function(key){return this.SET(key,null).COMPACT()},remove:function(key){return this.copy().REMOVE(key)},EMPTY:function(){var self=this;return jQuery.each(self.keys,function(key){delete self.keys[key]}),self},load:function(url){var hash=url.replace(/^.*?[#](.+?)(?:\?.+)?$/,"$1"),search=url.replace(/^.*?[?](.+?)(?:#.+)?$/,"$1");return new queryObject(url.length==search.length?"":search,url.length==hash.length?"":hash)},empty:function(){return this.copy().EMPTY()},copy:function(){return new queryObject(this)},COMPACT:function(){function build(orig){function add(o,key,value){is(o,Array)?o.push(value):o[key]=value}var obj="object"==typeof orig?is(orig,Array)?[]:{}:orig;return"object"==typeof orig&&jQuery.each(orig,function(key,value){return is(value)?void add(obj,key,build(value)):!0}),obj}return this.keys=build(this.keys),this},compact:function(){return this.copy().COMPACT()},toString:function(){var queryString=[],chunks=[],encode=function(str){return str+="",$spaces&&(str=str.replace(/ /g,"+")),encodeURIComponent(str)},addFields=function(arr,key,value){if(is(value)&&value!==!1){var o=[encode(key)];value!==!0&&(o.push("="),o.push(encode(value))),arr.push(o.join(""))}},build=function(obj,base){var newKey=function(key){return base&&""!=base?[base,"[",key,"]"].join(""):[key].join("")};jQuery.each(obj,function(key,value){"object"==typeof value?build(value,newKey(key)):addFields(chunks,newKey(key),value)})};return build(this.keys),chunks.length>0&&queryString.push($hash),queryString.push(chunks.join($separator)),queryString.join("")}},new queryObject(location.search,location.hash)}}(jQuery.query||{}),css_browser_selector(navigator.userAgent),function($){var methods={init:function(options){var state={timer:null,timerSeconds:10,callback:function(){},timerCurrent:0,showPercentage:!1,fill:!1,color:"#CCC"};return state=$.extend(state,options),this.each(function(){var $this=$(this),data=$this.data("pietimer");data||($this.addClass("pietimer"),$this.css({fontSize:$this.width()}),$this.data("pietimer",state),state.showPercentage&&$this.find(".percent").show(),state.fill&&$this.addClass("fill"),$this.pietimer("start"))})},stopWatch:function(){var data=$(this).data("pietimer");if(data){var seconds=(data.timerFinish-(new Date).getTime())/1e3;if(0>=seconds)clearInterval(data.timer),$(this).pietimer("drawTimer",100),data.callback();else{var percent=100-seconds/data.timerSeconds*100;$(this).pietimer("drawTimer",percent)}}},drawTimer:function(percent){$this=$(this);var data=$this.data("pietimer");if(data){$this.html('<div class="percent"></div><div class="slice'+(percent>50?' gt50"':'"')+'><div class="pie"></div>'+(percent>50?'<div class="pie fill"></div>':"")+"</div>");var deg=3.6*percent;$this.find(".slice .pie").css({"-moz-transform":"rotate("+deg+"deg)","-webkit-transform":"rotate("+deg+"deg)","-o-transform":"rotate("+deg+"deg)",transform:"rotate("+deg+"deg)"}),$this.find(".percent").html(Math.round(percent)+"%"),data.showPercentage&&$this.find(".percent").show(),$this.find(".slice .pie").css($this.hasClass("fill")?{backgroundColor:data.color}:{borderColor:data.color})}},start:function(){var data=$(this).data("pietimer");data&&(data.timerFinish=(new Date).getTime()+1e3*data.timerSeconds,$(this).pietimer("drawTimer",0),data.timer=setInterval("$this.pietimer('stopWatch')",50))},reset:function(){var data=$(this).data("pietimer");data&&(clearInterval(data.timer),$(this).pietimer("drawTimer",0))}};$.fn.pietimer=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.pietimer"):methods.init.apply(this,arguments)}}(jQuery),function(root,factory){"object"==typeof exports?module.exports=factory():"function"==typeof define&&define.amd?define(factory):root.Spinner=factory()}(this,function(){"use strict";function createEl(tag,prop){var n,el=document.createElement(tag||"div");for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;n>i;i++)parent.appendChild(arguments[i]);return parent}function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(100*alpha),i,lines].join("-"),start=.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";return animations[name]||(sheet.insertRule("@"+pre+"keyframes "+name+"{0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}100%{opacity:"+z+"}}",sheet.cssRules.length),animations[name]=1),name}function vendor(el,prop){var pp,i,s=el.style;for(prop=prop.charAt(0).toUpperCase()+prop.slice(1),i=0;i<prefixes.length;i++)if(pp=prefixes[i]+prop,void 0!==s[pp])return pp;return void 0!==s[prop]?prop:void 0}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def)void 0===obj[n]&&(obj[n]=def[n])}return obj}function getColor(color,idx){return"string"==typeof color?color:color[idx%color.length]}function Spinner(o){this.opts=merge(o||{},Spinner.defaults,defaults)}function initVML(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}sheet.addRule(".spin-vml","behavior:url(#default#VML)"),Spinner.prototype.lines=function(el,o){function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})
}function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:getColor(o.color,i),opacity:o.opacity}),vml("stroke",{opacity:0}))))}var i,r=o.length+o.width,s=2*r,margin=2*-(o.width+o.length)+"px",g=css(grp(),{position:"absolute",top:margin,left:margin});if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)},Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0,c&&i+o<c.childNodes.length&&(c=c.childNodes[i+o],c=c&&c.firstChild,c=c&&c.firstChild,c&&(c.opacity=val))}}var useCssAnimations,prefixes=["webkit","Moz","ms","O"],animations={},sheet=function(){var el=createEl("style",{type:"text/css"});return ins(document.getElementsByTagName("head")[0],el),el.sheet||el.styleSheet}(),defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};Spinner.defaults={},merge(Spinner.prototype,{spin:function(target){this.stop();{var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex});o.radius+o.length+o.width}if(css(el,{left:o.left,top:o.top}),target&&target.insertBefore(el,target.firstChild||null),el.setAttribute("role","progressbar"),self.lines(el,self.opts),!useCssAnimations){var alpha,i=0,start=(o.lines-1)*(1-o.direction)/2,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;!function anim(){i++;for(var j=0;j<o.lines;j++)alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity),self.opacity(el,j*o.direction+start,alpha,o);self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))}()}return self},stop:function(){var el=this.el;return el&&(clearTimeout(this.timeout),el.parentNode&&el.parentNode.removeChild(el),this.el=void 0),this},lines:function(el,o){function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px,0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(var seg,i=0,start=(o.lines-1)*(1-o.direction)/2;i<o.lines;i++)seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&ins(seg,css(fill("#000","0 0 4px #000"),{top:"2px"})),ins(el,ins(seg,fill(getColor(o.color,i),"0 0 1px rgba(0,0,0,.1)")));return el},opacity:function(el,i,val){i<el.childNodes.length&&(el.childNodes[i].style.opacity=val)}});var probe=css(createEl("group"),{behavior:"url(#default#VML)"});return!vendor(probe,"transform")&&probe.adj?initVML():useCssAnimations=vendor(probe,"animation"),Spinner}),function(e){function h(a){throw new RangeError("noUiSlider: "+a)}function x(a,b,d){(a[b]||a[d])&&a[b]===a[d]&&h("(Link) '"+b+"' can't match '"+d+"'.'")}function t(a){return"number"==typeof a&&!isNaN(a)&&isFinite(a)}function H(a){return e.isArray(a)?a:[a]}function D(a,b){a.addClass(b),setTimeout(function(){a.removeClass(b)},300)}function y(a,b){return 100*b/(a[1]-a[0])}function I(a,b){if(b>=a.d.slice(-1)[0])return 100;for(var c,g,e,d=1;b>=a.d[d];)d++;return c=a.d[d-1],g=a.d[d],e=a.c[d-1],c=[c,g],e+y(c,0>c[0]?b+Math.abs(c[0]):b-c[0])/(100/(a.c[d]-e))}function J(a,b){for(var c,d=1;b>=a.c[d];)d++;return a.m?(c=a.c[d-1],d=a.c[d],b-c>(d-c)/2?d:c):(a.h[d-1]?(c=a.h[d-1],d=a.c[d-1]+Math.round((b-a.c[d-1])/c)*c):d=b,d)}function s(a){void 0===a&&(a={}),"object"!=typeof a&&h("(Format) 'format' option must be an object.");var b={};e(K).each(function(d,c){void 0===a[c]?b[c]=z[d]:typeof a[c]==typeof z[d]?("decimals"===c&&(0>a[c]||7<a[c])&&h("(Format) 'format.decimals' option must be between 0 and 7."),b[c]=a[c]):h("(Format) 'format."+c+"' must be a "+typeof z[d]+".")}),x(b,"mark","thousand"),x(b,"prefix","negative"),x(b,"prefix","negativeBefore"),this.B=b}function q(a,b){if(!(this instanceof q))throw Error("Link: Don't use Link as a function. Use the 'new' keyword.");if(!a)throw new RangeError("Link: missing parameters.");this.g=a.format||{},this.update=!b;var d=this,c=a.target||function(){},g=a.method,f="string"==typeof c&&0===c.indexOf("-tooltip-"),h="string"==typeof c&&0!==c.indexOf("-"),n="function"==typeof c,r=c instanceof e||e.zepto&&e.zepto.isZ(c),E=r&&c.is("input, select, textarea"),l=r&&"function"==typeof g,s=r&&"string"==typeof g&&c[g];if(f)this.method=g||"html",this.j=e(c.replace("-tooltip-","")||"<div/>")[0];else if(h)this.method="val",this.j=document.createElement("input"),this.j.name=c,this.j.type="hidden";else{if(!n){if(r){if(g&&(l||s))return this.target=c,void(this.method=g);if(!g&&E)return this.method="val",this.target=c,void this.target.on("change",function(a){a=e(a.target).val();var b=d.q;d.u.val([b?null:a,b?a:null],{link:d})});if(!g&&!E)return this.method="html",void(this.target=c)}throw new RangeError("Link: Invalid Link.")}this.target=!1,this.method=c}}function L(a,b){t(b)||h("'step' is not numeric."),a.h[0]=b}function M(a,b){("object"!=typeof b||e.isArray(b))&&h("'range' is not an object."),e.each(b,function(b,c){var g;"number"==typeof c&&(c=[c]),e.isArray(c)||h("'range' contains invalid value."),g="min"===b?0:"max"===b?100:parseFloat(b),t(g)&&t(c[0])||h("'range' value isn't numeric."),a.c.push(g),a.d.push(c[0]),g?a.h.push(isNaN(c[1])?!1:c[1]):isNaN(c[1])||(a.h[0]=c[1])}),e.each(a.h,function(b,c){return c?void(a.h[b]=y([a.d[b],a.d[b+1]],c)/(100/(a.c[b+1]-a.c[b]))):!0})}function N(a,b){"number"==typeof b&&(b=[b]),(!e.isArray(b)||!b.length||2<b.length)&&h("'start' option is incorrect."),a.a=b.length,a.start=b}function O(a,b){a.m=b,"boolean"!=typeof b&&h("'snap' option must be a boolean.")}function P(a,b){"lower"===b&&1===a.a?a.i=1:"upper"===b&&1===a.a?a.i=2:!0===b&&2===a.a?a.i=3:!1===b?a.i=0:h("'connect' option was doesn't match handle count.")}function Q(a,b){switch(b){case"horizontal":a.k=0;break;case"vertical":a.k=1;break;default:h("'orientation' option is invalid.")}}function R(a,b){2<a.c.length&&h("'margin' option is only supported on linear sliders."),a.margin=y(a.d,b),t(b)||h("'margin' option must be numeric.")}function S(a,b){switch(b){case"ltr":a.dir=0;break;case"rtl":a.dir=1,a.i=[0,2,1,3][a.i];break;default:h("'direction' option was not recognized.")}}function T(a,b){"string"!=typeof b&&h("'behaviour' must be a string containing options.");var d=0<=b.indexOf("snap");a.n={p:0<=b.indexOf("tap")||d,extend:0<=b.indexOf("extend"),s:0<=b.indexOf("drag"),fixed:0<=b.indexOf("fixed"),m:d}}function U(a,b,d){a.o=[b.lower,b.upper],a.g=new s(b.format),e.each(a.o,function(a,g){e.isArray(g)||h("'serialization."+(a?"upper":"lower")+"' must be an array."),e.each(g,function(){this instanceof q||h("'serialization."+(a?"upper":"lower")+"' can only contain Link instances."),this.q=a,this.u=d,this.scope=this.scope||d,this.g=new s(e.extend({},b.format,this.g))})}),a.dir&&1<a.a&&a.o.reverse()}function V(a,b){var c,d={c:[],d:[],h:[!1],margin:0};return c={step:{e:!1,f:L},range:{e:!0,f:M},start:{e:!0,f:N},snap:{e:!1,f:O},connect:{e:!0,f:P},orientation:{e:!1,f:Q},margin:{e:!1,f:R},direction:{e:!0,f:S},behaviour:{e:!0,f:T},serialization:{e:!0,f:U}},a=e.extend({connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},a),a.serialization=e.extend({lower:[],upper:[],format:{}},a.serialization),e.each(c,function(c,e){if(void 0===a[c]){if(!e.e)return!0;h("'"+c+"' is required.")}e.f(d,a[c],b)}),d.style=d.k?"top":"left",d}function W(a,b){var d=e("<div><div/></div>").addClass(f[2]),c=["-lower","-upper"];return a.dir&&c.reverse(),d.children().addClass(f[3]+" "+f[3]+c[b]),d}function X(a,b){return b.j&&(b=new q({target:e(b.j).clone().appendTo(a),method:b.method,format:b.g},!0)),b}function Y(a,b){var d,c=[];for(d=0;d<a.a;d++){var e=c,f=d,h=a.o[d],n=b[d].children(),r=void 0,l=[];for(l.push(new q({format:a.g},!0)),r=0;r<h.length;r++)l.push(X(n,h[r]));e[f]=l}return c}function Z(a,b,d){switch(a){case 1:b.addClass(f[7]),d[0].addClass(f[6]);break;case 3:d[1].addClass(f[6]);case 2:d[0].addClass(f[7]);case 0:b.addClass(f[6])}}function aa(a,b){var d,c=[];for(d=0;d<a.a;d++)c.push(W(a,d).appendTo(b));return c}function ba(a,b){return b.addClass([f[0],f[8+a.dir],f[4+a.k]].join(" ")),e("<div/>").appendTo(b).addClass(f[1])}function ca(a,b,d){function c(){return u[["width","height"][b.k]]()}function g(a){var b,c=[m.val()];for(b=0;b<a.length;b++)m.trigger(a[b],c)}function h(a,c,d){var g=a[0]!==k[0][0]?1:0,p=v[0]+b.margin,F=v[1]-b.margin;return d&&1<k.length&&(c=g?Math.max(c,p):Math.min(c,F)),100>c&&(c=J(b,c)),c=Math.max(Math.min(parseFloat(c.toFixed(7)),100),0),c===v[g]?1===k.length?!1:c===p||c===F?0:!1:(a.css(b.style,c+"%"),a.is(":first-child")&&a.toggleClass(f[17],c>50),v[g]=c,b.dir&&(c=100-c),e(w[g]).each(function(){this.write(b,c,a.children(),m)}),!0)}function q(a,b,c){c||D(m,f[14]),h(a,b,!1),g(["slide","set","change"])}function n(a,c,d,e){a=a.replace(/\s/g,".nui ")+".nui",c.on(a,function(a){var c=m.attr("disabled");if(m.hasClass(f[14])||void 0!==c&&null!==c)return!1;a.preventDefault();var A,h,c=0===a.type.indexOf("touch"),g=0===a.type.indexOf("mouse"),B=0===a.type.indexOf("pointer"),k=a;0===a.type.indexOf("MSPointer")&&(B=!0),a.originalEvent&&(a=a.originalEvent),c&&(A=a.changedTouches[0].pageX,h=a.changedTouches[0].pageY),(g||B)&&(B||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),A=a.clientX+window.pageXOffset,h=a.clientY+window.pageYOffset),k.v=[A,h],k.cursor=g,a=k,a.l=a.v[b.k],d(a,e)})}function r(a,b){var e,d=b.a||k,f=!1,f=100*(a.l-b.start)/c(),m=d[0][0]!==k[0][0]?1:0,n=b.w;e=f+n[0],f+=n[1],1<d.length?(0>e&&(f+=Math.abs(e)),f>100&&(e-=f-100),e=[Math.max(Math.min(e,100),0),Math.max(Math.min(f,100),0)]):e=[e,f],f=h(d[0],e[m],1===d.length),1<d.length&&(f=h(d[1],e[m?0:1],!1)||f),f&&g(["slide"])}function s(a){e("."+f[15]).removeClass(f[15]),a.cursor&&e("body").css("cursor","").off(".nui"),C.off(".nui"),m.removeClass(f[12]),g(["set","change"])}function t(a,b){1===b.a.length&&b.a[0].children().addClass(f[15]),a.stopPropagation(),n(l.move,C,r,{start:a.l,a:b.a,w:[v[0],v[k.length-1]]}),n(l.end,C,s,null),a.cursor&&(e("body").css("cursor",e(a.target).css("cursor")),1<k.length&&m.addClass(f[12]),e("body").on("selectstart.nui",!1))}function x(a){var d=a.l,g=0;a.stopPropagation(),e.each(k,function(){g+=this.offset()[b.style]}),g=g/2>d||1===k.length?0:1,d-=u.offset()[b.style],d=100*d/c(),q(k[g],d,b.n.m),b.n.m&&t(a,{a:[k[g]]})}function y(a){var c=(a=a.l<u.offset()[b.style])?0:100;a=a?0:k.length-1,q(k[a],c,!1)}var u,w,k,m=e(a),v=[-1,-1];if(!m.is(":empty"))throw Error("Slider was already initialized.");u=ba(b,m),k=aa(b,u),w=Y(b,k),Z(b.i,m,k),function(a){var b;if(!a.fixed)for(b=0;b<k.length;b++)n(l.start,k[b].children(),t,{a:[k[b]]});a.p&&n(l.start,u,x,{a:k}),a.extend&&(m.addClass(f[16]),a.p&&n(l.start,m,y,{a:k})),a.s&&(b=u.find("."+f[7]).addClass(f[10]),a.fixed&&(b=b.add(u.children().not(b).children())),n(l.start,b,t,{a:k}))}(b.n),a.F=function(a,c,d,n,p){var l;for(b.dir&&1<b.a&&a.reverse(),p&&D(m,f[14]),l=0;l<(1<k.length?3:1);l++)p=d||w[l%2][0],p=p.valueOf(a[l%2]),!1!==p&&(p=I(b,p),b.dir&&(p=100-p),!0!==h(k[l%2],p,!0)&&e(w[l%2]).each(function(){this.write(b,v[l%2],k[l%2].children(),m,n)}));!0===c&&g(["set"])},a.D=function(){var a,c=[];for(a=0;a<b.a;a++)c[a]=w[a][0].A;return 1===c.length?c[0]:b.dir&&1<b.a?c.reverse():c},a.r=function(){return e.each(w,function(){e.each(this,function(){this.target&&this.target.off(".nui")})}),e(this).off(".nui").removeClass(f.join(" ")).empty(),d},m.val(b.start)}function da(a){this.length||h("Can't initialize slider on empty selection.");var b=V(a,this);return this.each(function(){ca(this,b,a)})}function ea(a){return this.each(function(){var b=e(this).val(),d=this.r(),c=e.extend({},d,a);e(this).noUiSlider(c),d.start===c.start&&e(this).val(b)})}var C=e(document),G=e.fn.val,l=window.navigator.G?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},f="noUi-target noUi-base noUi-origin noUi-handle noUi-horizontal noUi-vertical noUi-background noUi-connect noUi-ltr noUi-rtl noUi-dragable  noUi-state-drag  noUi-state-tap noUi-active noUi-extended noUi-stacking".split(" "),K="decimals mark thousand prefix postfix encoder decoder negative negativeBefore".split(" "),z=[2,".","","","",function(a){return a},function(a){return a},"-",""];s.prototype.b=function(a){return this.B[a]},s.prototype.C=function(a){function b(a){return a.split("").reverse().join("")}a=this.b("encoder")(a);var d="",c="",e="",f="";return 0>a&&(d=this.b("negative"),c=this.b("negativeBefore")),a=Math.abs(a).toFixed(this.b("decimals")).toString(),a=a.split("."),0===parseFloat(a)&&(a[0]="0"),this.b("thousand")?(e=b(a[0]).match(/.{1,3}/g),e=b(e.join(b(this.b("thousand"))))):e=a[0],this.b("mark")&&1<a.length&&(f=this.b("mark")+a[1]),c+this.b("prefix")+d+e+f+this.b("postfix")},s.prototype.t=function(a){function b(a){return a.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}var d;return null===a||void 0===a?!1:(a=a.toString(),d=a.replace(RegExp("^"+b(this.b("negativeBefore"))),""),a!==d?(a=d,d="-"):d="",a=a.replace(RegExp("^"+b(this.b("prefix"))),""),this.b.negative&&(d="",a=a.replace(RegExp("^"+b(this.b("negative"))),"-")),a=a.replace(RegExp(b(this.b("postfix"))+"$"),"").replace(RegExp(b(this.b("thousand")),"g"),"").replace(this.b("mark"),"."),a=this.b("decoder")(parseFloat(d+a)),isNaN(a)?!1:a)},q.prototype.write=function(a,b,d,c,e){if(!this.update||!1!==e){if(b>=100)b=a.d.slice(-1)[0];else{e=1;for(var f,h,l;b>=a.c[e];)e++;f=a.d[e-1],h=a.d[e],l=a.c[e-1],f=[f,h],b=100/(a.c[e]-l)*(b-l)*(f[1]-f[0])/100+f[0]}this.A=b=this.format(b),"function"==typeof this.method?this.method.call(this.target[0]||c[0],b,d,c):this.target[this.method](b,d,c)}},q.prototype.format=function(a){return this.g.C(a)},q.prototype.valueOf=function(a){return this.g.t(a)},e.noUiSlider={Link:q},e.fn.noUiSlider=function(a,b){return(b?ea:da).call(this,a)},e.fn.val=function(){var b,d,c,g,a=Array.prototype.slice.call(arguments,0);return a.length?("object"==typeof a[1]?(b=a[1].set,d=a[1].link,c=a[1].update,g=a[1].animate):!0===a[1]&&(b=!0),this.each(function(){e(this).hasClass(f[0])?this.F(H(a[0]),b,d,c,g):G.apply(e(this),a)})):this.hasClass(f[0])?this[0].D():G.apply(this)}}(window.jQuery||window.Zepto),$("html").ajaxSend(function(event,xhr,settings){function getCookie(name){var cookieValue=null;if(document.cookie&&""!=document.cookie)for(var cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}return cookieValue}function sameOrigin(url){var host=document.location.host,protocol=document.location.protocol,sr_origin="//"+host,origin=protocol+sr_origin;return url==origin||url.slice(0,origin.length+1)==origin+"/"||url==sr_origin||url.slice(0,sr_origin.length+1)==sr_origin+"/"||!/^(\/\/|http:|https:).*/.test(url)}function safeMethod(method){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(method)}!safeMethod(settings.type)&&sameOrigin(settings.url)&&xhr.setRequestHeader("X-CSRFToken",getCookie("csrftoken"))});var JSON;JSON||(JSON={}),function(){"use strict";function f(n){return 10>n?"0"+n:n}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;length>i;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;length>i;i+=1)"string"==typeof rep[i]&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;space>i;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,slice=ArrayProto.slice,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return new wrapper(obj)};"undefined"!=typeof module&&module.exports?(module.exports=_,_._=_):root._=_,_.VERSION="1.1.5";var each=_.each=_.forEach=function(obj,iterator,context){if(null!=obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(_.isNumber(obj.length)){for(var i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(hasOwnProperty.call(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return};_.map=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)}),results)},_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=void 0!==memo;if(null==obj&&(obj=[]),nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);if(each(obj,function(value,index,list){initial||0!==index?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)}),!initial)throw new TypeError("Reduce of empty array with no initial value");return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){if(null==obj&&(obj=[]),nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),void 0!==memo?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var reversed=(_.isArray(obj)?obj.slice():_.toArray(obj)).reverse();return _.reduce(reversed,iterator,memo,context)},_.find=_.detect=function(obj,iterator,context){var result;return any(obj,function(value,index,list){return iterator.call(context,value,index,list)?(result=value,!0):void 0}),result},_.filter=_.select=function(obj,iterator,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(iterator,context):(each(obj,function(value,index,list){iterator.call(context,value,index,list)&&(results[results.length]=value)}),results)},_.reject=function(obj,iterator,context){var results=[];return null==obj?results:(each(obj,function(value,index,list){iterator.call(context,value,index,list)||(results[results.length]=value)}),results)},_.every=_.all=function(obj,iterator,context){iterator=iterator||_.identity;var result=!0;return null==obj?result:nativeEvery&&obj.every===nativeEvery?obj.every(iterator,context):(each(obj,function(value,index,list){return(result=result&&iterator.call(context,value,index,list))?void 0:breaker}),result)};var any=_.some=_.any=function(obj,iterator,context){iterator=iterator||_.identity;var result=!1;return null==obj?result:nativeSome&&obj.some===nativeSome?obj.some(iterator,context):(each(obj,function(value,index,list){return(result=iterator.call(context,value,index,list))?breaker:void 0}),result)};_.include=_.contains=function(obj,target){var found=!1;return null==obj?found:nativeIndexOf&&obj.indexOf===nativeIndexOf?-1!=obj.indexOf(target):(any(obj,function(value){return(found=value===target)?!0:void 0}),found)},_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(method?value[method]:value).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.max.apply(Math,obj);var result={computed:-1/0};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})}),result.value},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.min.apply(Math,obj);var result={computed:1/0};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})}),result.value},_.sortBy=function(obj,iterator,context){return _.pluck(_.map(obj,function(value,index,list){return{value:value,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;return b>a?-1:a>b?1:0}),"value")},_.sortedIndex=function(array,obj,iterator){iterator=iterator||_.identity;for(var low=0,high=array.length;high>low;){var mid=low+high>>1;iterator(array[mid])<iterator(obj)?low=mid+1:high=mid}return low},_.toArray=function(iterable){return iterable?iterable.toArray?iterable.toArray():_.isArray(iterable)?iterable:_.isArguments(iterable)?slice.call(iterable):_.values(iterable):[]},_.size=function(obj){return _.toArray(obj).length},_.first=_.head=function(array,n,guard){return null==n||guard?array[0]:slice.call(array,0,n)},_.rest=_.tail=function(array,index,guard){return slice.call(array,null==index||guard?1:index)},_.last=function(array){return array[array.length-1]},_.compact=function(array){return _.filter(array,function(value){return!!value})},_.flatten=function(array){return _.reduce(array,function(memo,value){return _.isArray(value)?memo.concat(_.flatten(value)):(memo[memo.length]=value,memo)},[])},_.without=function(array){var values=slice.call(arguments,1);return _.filter(array,function(value){return!_.include(values,value)})},_.uniq=_.unique=function(array,isSorted){return _.reduce(array,function(memo,el,i){return 0!=i&&(isSorted===!0?_.last(memo)==el:_.include(memo,el))||(memo[memo.length]=el),memo},[])},_.intersect=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})},_.zip=function(){for(var args=slice.call(arguments),length=_.max(_.pluck(args,"length")),results=new Array(length),i=0;length>i;i++)results[i]=_.pluck(args,""+i);return results},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i,l;if(isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;l>i;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item){if(null==array)return-1;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return array.lastIndexOf(item);for(var i=array.length;i--;)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;for(var len=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(len);len>idx;)range[idx++]=start,start+=step;return range},_.bind=function(func,obj){if(nativeBind&&func.bind===nativeBind)return func.bind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(obj,args.concat(slice.call(arguments)))}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);return 0==funcs.length&&(funcs=_.functions(obj)),each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher=hasher||_.identity,function(){var key=hasher.apply(this,arguments);return hasOwnProperty.call(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(func,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};var limit=function(func,wait,debounce){var timeout;return function(){var context=this,args=arguments,throttler=function(){timeout=null,func.apply(context,args)};debounce&&clearTimeout(timeout),(debounce||!timeout)&&(timeout=setTimeout(throttler,wait))}};_.throttle=function(func,wait){return limit(func,wait,!1)},_.debounce=function(func,wait){return limit(func,wait,!0)},_.once=function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments))}},_.wrap=function(func,wrapper){return function(){var args=[func].concat(slice.call(arguments));return wrapper.apply(this,args)}},_.compose=function(){var funcs=slice.call(arguments);return function(){for(var args=slice.call(arguments),i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)hasOwnProperty.call(obj,key)&&(keys[keys.length]=key);return keys},_.values=function(obj){return _.map(obj,_.identity)},_.functions=_.methods=function(obj){return _.filter(_.keys(obj),function(key){return _.isFunction(obj[key])}).sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){for(var prop in source)obj[prop]=source[prop]}),obj},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){for(var prop in source)null==obj[prop]&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isArray(obj)?obj.slice():_.extend({},obj)},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isEqual=function(a,b){if(a===b)return!0;var atype=typeof a,btype=typeof b;if(atype!=btype)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;if(a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped),a.isEqual)return a.isEqual(b);if(_.isDate(a)&&_.isDate(b))return a.getTime()===b.getTime();if(_.isNaN(a)&&_.isNaN(b))return!1;if(_.isRegExp(a)&&_.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if("object"!==atype)return!1;if(a.length&&a.length!==b.length)return!1;var aKeys=_.keys(a),bKeys=_.keys(b);if(aKeys.length!=bKeys.length)return!1;for(var key in a)if(!(key in b&&_.isEqual(a[key],b[key])))return!1;return!0},_.isEmpty=function(obj){if(_.isArray(obj)||_.isString(obj))return 0===obj.length;for(var key in obj)if(hasOwnProperty.call(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!=obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},_.isArguments=function(obj){return!(!obj||!hasOwnProperty.call(obj,"callee"))},_.isFunction=function(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply)},_.isString=function(obj){return!!(""===obj||obj&&obj.charCodeAt&&obj.substr)},_.isNumber=function(obj){return!!(0===obj||obj&&obj.toExponential&&obj.toFixed)},_.isNaN=function(obj){return obj!==obj},_.isBoolean=function(obj){return obj===!0||obj===!1},_.isDate=function(obj){return!!(obj&&obj.getTimezoneOffset&&obj.setUTCFullYear)},_.isRegExp=function(obj){return!(!(obj&&obj.test&&obj.exec)||!obj.ignoreCase&&obj.ignoreCase!==!1)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.times=function(n,iterator,context){for(var i=0;n>i;i++)iterator.call(context,i)},_.mixin=function(obj){each(_.functions(obj),function(name){addToWrapper(name,_[name]=obj[name])})};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},_.template=function(str,data){var c=_.templateSettings,tmpl="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+str.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.interpolate,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(match,code){return"');"+code.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",func=new Function("obj",tmpl);return data?func(data):func};var wrapper=function(obj){this._wrapped=obj};_.prototype=wrapper.prototype;var result=function(obj,chain){return chain?_(obj).chain():obj},addToWrapper=function(name,func){wrapper.prototype[name]=function(){var args=slice.call(arguments);return unshift.call(args,this._wrapped),result(func.apply(_,args),this._chain)}};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return method.apply(this._wrapped,arguments),result(this._wrapped,this._chain)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return result(method.apply(this._wrapped,arguments),this._chain)}}),wrapper.prototype.chain=function(){return this._chain=!0,this
},wrapper.prototype.value=function(){return this._wrapped}}(),function(){var Backbone;Backbone="undefined"!=typeof exports?exports:this.Backbone={},Backbone.VERSION="0.3.3";var _=this._;_||"undefined"==typeof require||(_=require("underscore")._);var $=this.jQuery||this.Zepto;Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1,Backbone.Events={bind:function(ev,callback){var list=(this._callbacks||(this._callbacks={}),this._callbacks[ev]||(this._callbacks[ev]=[]));return list.push(callback),this},unbind:function(ev,callback){var calls;if(ev){if(calls=this._callbacks)if(callback){var list=calls[ev];if(!list)return this;for(var i=0,l=list.length;l>i;i++)if(callback===list[i]){list.splice(i,1);break}}else calls[ev]=[]}else this._callbacks={};return this},trigger:function(ev){var list,calls,i,l;if(!(calls=this._callbacks))return this;if(list=calls[ev])for(i=0,l=list.length;l>i;i++)list[i].apply(this,Array.prototype.slice.call(arguments,1));if(list=calls.all)for(i=0,l=list.length;l>i;i++)list[i].apply(this,arguments);return this}},Backbone.Model=function(attributes,options){attributes||(attributes={}),this.defaults&&(attributes=_.extend({},this.defaults,attributes)),this.attributes={},this._escapedAttributes={},this.cid=_.uniqueId("c"),this.set(attributes,{silent:!0}),this._previousAttributes=_.clone(this.attributes),options&&options.collection&&(this.collection=options.collection),this.initialize(attributes,options)},_.extend(Backbone.Model.prototype,Backbone.Events,{_previousAttributes:null,_changed:!1,initialize:function(){},toJSON:function(){return _.clone(this.attributes)},get:function(attr){return this.attributes[attr]},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;var val=this.attributes[attr];return this._escapedAttributes[attr]=escapeHTML(null==val?"":val)},set:function(attrs,options){if(options||(options={}),!attrs)return this;attrs.attributes&&(attrs=attrs.attributes);var now=this.attributes,escaped=this._escapedAttributes;if(!options.silent&&this.validate&&!this._performValidation(attrs,options))return!1;"id"in attrs&&(this.id=attrs.id);for(var attr in attrs){var val=attrs[attr];_.isEqual(now[attr],val)||(now[attr]=val,delete escaped[attr],options.silent||(this._changed=!0,this.trigger("change:"+attr,this,val,options)))}return!options.silent&&this._changed&&this.change(options),this},unset:function(attr,options){options||(options={});var validObj=(this.attributes[attr],{});return validObj[attr]=void 0,options.silent||!this.validate||this._performValidation(validObj,options)?(delete this.attributes[attr],delete this._escapedAttributes[attr],options.silent||(this._changed=!0,this.trigger("change:"+attr,this,void 0,options),this.change(options)),this):!1},clear:function(options){options||(options={});var old=this.attributes,validObj={};for(attr in old)validObj[attr]=void 0;if(!options.silent&&this.validate&&!this._performValidation(validObj,options))return!1;if(this.attributes={},this._escapedAttributes={},!options.silent){this._changed=!0;for(attr in old)this.trigger("change:"+attr,this,void 0,options);this.change(options)}return this},fetch:function(options){options||(options={});var model=this,success=function(resp){return model.set(model.parse(resp),options)?void(options.success&&options.success(model,resp)):!1},error=wrapError(options.error,model,options);return(this.sync||Backbone.sync)("read",this,success,error),this},save:function(attrs,options){if(options||(options={}),attrs&&!this.set(attrs,options))return!1;var model=this,success=function(resp){return model.set(model.parse(resp),options)?void(options.success&&options.success(model,resp)):!1},error=wrapError(options.error,model,options),method=this.isNew()?"create":"update";return(this.sync||Backbone.sync)(method,this,success,error),this},destroy:function(options){options||(options={});var model=this,success=function(resp){model.collection&&model.collection.remove(model),options.success&&options.success(model,resp)},error=wrapError(options.error,model,options);return(this.sync||Backbone.sync)("delete",this,success,error),this},url:function(){var base=getUrl(this.collection);return this.isNew()?base:base+("/"==base.charAt(base.length-1)?"":"/")+this.id},parse:function(resp){return resp},clone:function(){return new this.constructor(this)},isNew:function(){return!this.id},change:function(options){this.trigger("change",this,options),this._previousAttributes=_.clone(this.attributes),this._changed=!1},hasChanged:function(attr){return attr?this._previousAttributes[attr]!=this.attributes[attr]:this._changed},changedAttributes:function(now){now||(now=this.attributes);var old=this._previousAttributes,changed=!1;for(var attr in now)_.isEqual(old[attr],now[attr])||(changed=changed||{},changed[attr]=now[attr]);return changed},previous:function(attr){return attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},_performValidation:function(attrs,options){var error=this.validate(attrs);return error?(options.error?options.error(this,error):this.trigger("error",this,error,options),!1):!0}}),Backbone.Collection=function(models,options){options||(options={}),options.comparator&&(this.comparator=options.comparator,delete options.comparator),this._boundOnModelEvent=_.bind(this._onModelEvent,this),this._reset(),models&&this.refresh(models,{silent:!0}),this.initialize(models,options)},_.extend(Backbone.Collection.prototype,Backbone.Events,{model:Backbone.Model,initialize:function(){},toJSON:function(){return this.map(function(model){return model.toJSON()})},add:function(models,options){if(_.isArray(models))for(var i=0,l=models.length;l>i;i++)this._add(models[i],options);else this._add(models,options);return this},remove:function(models,options){if(_.isArray(models))for(var i=0,l=models.length;l>i;i++)this._remove(models[i],options);else this._remove(models,options);return this},get:function(id){return null==id?null:this._byId[null!=id.id?id.id:id]},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid]},at:function(index){return this.models[index]},sort:function(options){if(options||(options={}),!this.comparator)throw new Error("Cannot sort a set without a comparator");return this.models=this.sortBy(this.comparator),options.silent||this.trigger("refresh",this,options),this},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr)})},refresh:function(models,options){return models||(models=[]),options||(options={}),this._reset(),this.add(models,{silent:!0}),options.silent||this.trigger("refresh",this,options),this},fetch:function(options){options||(options={});var collection=this,success=function(resp){collection.refresh(collection.parse(resp)),options.success&&options.success(collection,resp)},error=wrapError(options.error,collection,options);return(this.sync||Backbone.sync)("read",this,success,error),this},create:function(model,options){var coll=this;options||(options={}),model instanceof Backbone.Model?model.collection=coll:model=new this.model(model,{collection:coll});var success=function(nextModel,resp){coll.add(nextModel),options.success&&options.success(nextModel,resp)};return model.save(null,{success:success,error:options.error})},parse:function(resp){return resp},chain:function(){return _(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_add:function(model,options){options||(options={}),model instanceof Backbone.Model||(model=new this.model(model,{collection:this}));var already=this.getByCid(model);if(already)throw new Error(["Can't add the same model to a set twice",already.id]);this._byId[model.id]=model,this._byCid[model.cid]=model,model.collection=this;var index=this.comparator?this.sortedIndex(model,this.comparator):this.length;return this.models.splice(index,0,model),model.bind("all",this._boundOnModelEvent),this.length++,options.silent||model.trigger("add",model,this,options),model},_remove:function(model,options){return options||(options={}),(model=this.getByCid(model)||this.get(model))?(delete this._byId[model.id],delete this._byCid[model.cid],delete model.collection,this.models.splice(this.indexOf(model),1),this.length--,options.silent||model.trigger("remove",model,this,options),model.unbind("all",this._boundOnModelEvent),model):null},_onModelEvent:function(ev,model){"change:id"===ev&&(delete this._byId[model.previous("id")],this._byId[model.id]=model),this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty"];_.each(methods,function(method){Backbone.Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)))}}),Backbone.Controller=function(options){options||(options={}),options.routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize(options)};var namedParam=/:([\w\d]+)/g,splatParam=/\*([\w\d]+)/g;_.extend(Backbone.Controller.prototype,Backbone.Events,{initialize:function(){},route:function(route,name,callback){Backbone.history||(Backbone.history=new Backbone.History),_.isRegExp(route)||(route=this._routeToRegExp(route)),Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback.apply(this,args),this.trigger.apply(this,["route:"+name].concat(args))},this))},saveLocation:function(fragment){Backbone.history.saveLocation(fragment)},_bindRoutes:function(){if(this.routes)for(var route in this.routes){var name=this.routes[route];this.route(route,name,this[name])}},_routeToRegExp:function(route){return route=route.replace(namedParam,"([^/]*)").replace(splatParam,"(.*?)"),new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1)}}),Backbone.History=function(){this.handlers=[],this.fragment=this.getFragment(),_.bindAll(this,"checkUrl")};var hashStrip=/^#*/;_.extend(Backbone.History.prototype,{interval:50,getFragment:function(loc){return(loc||window.location).hash.replace(hashStrip,"")},start:function(){var docMode=document.documentMode,oldIE=$.browser.msie&&(!docMode||7>=docMode);return oldIE&&(this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow),"onhashchange"in window&&!oldIE?$(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval),this.loadUrl()},route:function(route,callback){this.handlers.push({route:route,callback:callback})},checkUrl:function(){var current=this.getFragment();return current==this.fragment&&this.iframe&&(current=this.getFragment(this.iframe.location)),current==this.fragment||current==decodeURIComponent(this.fragment)?!1:(this.iframe&&(window.location.hash=this.iframe.location.hash=current),void this.loadUrl())},loadUrl:function(){var fragment=this.fragment=this.getFragment(),matched=_.any(this.handlers,function(handler){return handler.route.test(fragment)?(handler.callback(fragment),!0):void 0});return matched},saveLocation:function(fragment){fragment=(fragment||"").replace(hashStrip,""),this.fragment!=fragment&&(window.location.hash=this.fragment=fragment,this.iframe&&fragment!=this.getFragment(this.iframe.location)&&(this.iframe.document.open().close(),this.iframe.location.hash=fragment))}}),Backbone.View=function(options){this._configure(options||{}),this._ensureElement(),this.delegateEvents(),this.initialize(options)};var selectorDelegate=function(selector){return $(selector,this.el)},eventSplitter=/^(\w+)\s*(.*)$/;_.extend(Backbone.View.prototype,Backbone.Events,{tagName:"div",$:selectorDelegate,initialize:function(){},render:function(){return this},remove:function(){return $(this.el).remove(),this},make:function(tagName,attributes,content){var el=document.createElement(tagName);return attributes&&$(el).attr(attributes),content&&$(el).html(content),el},delegateEvents:function(events){if(events||(events=this.events)){$(this.el).unbind();for(var key in events){var methodName=events[key],match=key.match(eventSplitter),eventName=match[1],selector=match[2],method=_.bind(this[methodName],this);""===selector?$(this.el).bind(eventName,method):$(this.el).delegate(selector,eventName,method)}}},_configure:function(options){this.options&&(options=_.extend({},this.options,options)),options.model&&(this.model=options.model),options.collection&&(this.collection=options.collection),options.el&&(this.el=options.el),options.id&&(this.id=options.id),options.className&&(this.className=options.className),options.tagName&&(this.tagName=options.tagName),this.options=options},_ensureElement:function(){if(!this.el){var attrs={};this.id&&(attrs.id=this.id),this.className&&(attrs["class"]=this.className),this.el=this.make(this.tagName,attrs)}}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);return child.extend=extend,child};Backbone.Model.extend=Backbone.Collection.extend=Backbone.Controller.extend=Backbone.View.extend=extend;var methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};Backbone.sync=function(method,model,success,error){var type=methodMap[method],modelJSON="create"===method||"update"===method?JSON.stringify(model.toJSON()):null,params={url:getUrl(model),type:type,contentType:"application/json",data:modelJSON,dataType:"json",processData:!1,success:success,error:error};Backbone.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.processData=!0,params.data=modelJSON?{model:modelJSON}:{}),Backbone.emulateHTTP&&("PUT"===type||"DELETE"===type)&&(Backbone.emulateJSON&&(params.data._method=type),params.type="POST",params.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type)}),$.ajax(params)};var ctor=function(){},inherits=function(parent,protoProps,staticProps){var child;return child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},ctor.prototype=parent.prototype,child.prototype=new ctor,protoProps&&_.extend(child.prototype,protoProps),staticProps&&_.extend(child,staticProps),child.prototype.constructor=child,child.__super__=parent.prototype,child},getUrl=function(object){if(!object||!object.url)throw new Error("A 'url' property or function must be specified");return _.isFunction(object.url)?object.url():object.url},wrapError=function(onError,model,options){return function(resp){onError?onError(model,resp):model.trigger("error",model,resp,options)}},escapeHTML=function(string){return string.replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}}();var BASE_URL="";"undefined"!=typeof STATIC_BASE_URL&&(BASE_URL=STATIC_BASE_URL);var Album=Backbone.Model.extend({initialize:function(){_.bindAll(this,"remove"),this.bind("remove",this.remove)},url:function(){return BASE_URL+"/website_api/album/"+this.get("album_id")+"?rand="+Math.random()},remove:function(){$.log("remove model"),this.destroy()},expiresClass:function(){return this.get("expires_days")<0?"expiresNever":this.get("expires_days")<3?"expiresSoon":"expiresFar"}}),Gallery=Backbone.Collection.extend({model:Album,initialize:function(){$.log("initializing gallery collection")},url:function(){return BASE_URL+"/website_api/albums?rand="+Math.random()}}),AlbumView=Backbone.View.extend({tagName:"li",className:"album",initialize:function(){_.bindAll(this,"render","remove"),this.model.bind("remove",this.remove),this.template=_.template($("#album-template").html())},render:function(){var expiresClass=this.model.expiresClass();return $(this.el).html(this.template(this.model.toJSON("album_id"))).find(".albumExpires").addClass(expiresClass),this},remove:function(){$(this.el).remove()}}),GalleryView=Backbone.View.extend({el:$("#theGalleries"),albumCount:0,initialize:function(){_.bindAll(this,"addOne","addAll","render","removeOne"),gTheGallery.bind("add",this.addOne),gTheGallery.bind("remove",this.removeOne),gTheGallery.bind("refresh",this.addAll),gTheGallery.bind("all",this.render),this.emptyGalleryTemplate=_.template($("#emptyGallery-template").html()),gTheGallery.fetch()},addOne:function(album){$(this.el).children("div.clearfix").remove(),this.albumCount+=1;var view=new AlbumView({model:album});$(this.el).append(view.render().el)},removeOne:function(){this.albumCount-=1},addAll:function(){this.albumCount=0,gTheGallery.each(this.addOne)},render:function(){return 0==this.albumCount?$(this.el).html(this.emptyGalleryTemplate()):($("#galleryEmptyMessage").remove(),$(this.el).append('<div class="clearfix"></div>')),this}}),GalleryController=Backbone.Controller.extend({routes:{"":"setHomeTab","tab/:tab":"setTab","tab/:tab/:cmd/:params":"setTabWithCommand"},setHomeTab:function(){$("#tabs").tabs("select","myAlbums"),location.href.match(/my_account$/)&&(location.href=location.href+"#tab/myAlbums")},setTab:function(tab){$("#tabs").tabs("select",tab)},setTabWithCommand:function(tab,cmd,params){if("picasa_upload"==cmd)try{object.trigger("upload_to_picasa",params),$("#tabs").tabs("select",tab),this.saveLocation("tab/"+tab)}catch(e){}else if("flickr_upload"==cmd)try{object.trigger("upload_to_flickr",params),$("#tabs").tabs("select",tab),this.saveLocation("tab/"+tab)}catch(e){}}}),gTheGallery=new Gallery,gTheGalleryController=new GalleryController;